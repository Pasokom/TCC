
/* this view are going to be used to  store in memory all the reminders of the current day*/
DROP VIEW IF EXISTS VIEW_LEMBRETES_DO_DIA;
  CREATE VIEW VGIEW_LEMBRETES_DO_DIA AS 
  SELECT UCODIGO,LCOD_LEMBRETE,TIPO_RECORRENCIA, HL_CODIGO, HL_RECORRENCIA
   FROM LEMBRETE AS L 
   INNER JOIN USUARIO ON FK_USUARIO  = UCODIGO 
   INNER JOIN HORARIO_LEMBRETE AS HL  ON LCOD_LEMBRETE = FK_LEMBRETE 
   WHERE (DATE(DATA_LEMBRETE) = DATE(NOW()) 
   OR DATE(CALCULO_RECORRENCIA(HL.DATA_LEMBRETE,L.TIPO_RECORRENCIA,HL.HL_RECORRENCIA))  = DATE(NOW())
   ) AND HL.HL_ATIVO AND L.ATIVO IN (TRUE);

/*this view are going to be used to store in memory all the 
reminders that the user had ever made ( if we want to change this 
is just add a where clause in there checking the field 'ATIVADO') */
DROP VIEW IF EXISTS VIEW_CARREGAR_TODOS_LEMBRETES;
    CREATE VIEW VIEW_CARREGAR_TODOS_LEMBRETES AS 
    SELECT UCODIGO,LCOD_LEMBRETE,HL_CODIGO
    FROM LEMBRETE 
    INNER JOIN USUARIO ON FK_USUARIO = UCODIGO 
    INNER JOIN HORARIO_LEMBRETE ON LCOD_LEMBRETE = FK_LEMBRETE;

 /* example of how to use GROUP_CONNCAT and GROUP_BY  */
SELECT LCOD_LEMBRETE, GROUP_CONCAT(HL_CODIGO) CODIGOS
 FROM VIEW_CARREGAR_LEMBRETES  WHERE UCODIGO = 1  
 GROUP BY LCOD_LEMBRETE; 